#!/usr/bin/env python3
"""
Custom rewrite CLI tool for pattern-based replacements
"""
import argparse
import sys
import re
from pathlib import Path

def main():
    parser = argparse.ArgumentParser(description="Rewrite code using pattern replacements")
    parser.add_argument("file", help="File to rewrite")
    parser.add_argument("--pattern", action="append", help="Pattern to find", default=[])
    parser.add_argument("--replacement", action="append", help="Replacement text", default=[])
    parser.add_argument("--description", help="Description of the changes")
    
    args = parser.parse_args()
    
    if not args.pattern:
        print("Error: At least one --pattern and --replacement pair is required", file=sys.stderr)
        sys.exit(1)
    
    if len(args.pattern) != len(args.replacement):
        print("Error: Number of patterns must match number of replacements", file=sys.stderr)
        sys.exit(1)
    
    file_path = Path(args.file)
    if not file_path.exists():
        print(f"Error: File {args.file} not found", file=sys.stderr)
        sys.exit(1)
    
    # Read the file
    with open(file_path, 'r') as f:
        content = f.read()
    
    original_content = content
    
    # Apply all pattern replacements
    for pattern, replacement in zip(args.pattern, args.replacement):
        # Escape special regex characters in the pattern for literal matching
        escaped_pattern = re.escape(pattern)
        content = re.sub(escaped_pattern, replacement, content)
    
    # Write back the file if changes were made
    if content != original_content:
        with open(file_path, 'w') as f:
            f.write(content)
        print(f"Successfully applied {len(args.pattern)} replacements to {args.file}")
        if args.description:
            print(f"Description: {args.description}")
    else:
        print(f"No changes needed for {args.file}")

if __name__ == "__main__":
    main()